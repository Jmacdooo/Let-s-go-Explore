<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Forever Dog ‚Äî Yosemite Road Trip</title>
  <style>
    body{
      margin:0;
      background:#bde0fe;
      overflow:hidden;
      font-family: system-ui, -apple-system, sans-serif;
    }
    canvas{
      display:block;
      width:100vw;
      height:100vh;
    }
    #controls{
      position:fixed;
      left:10px;
      top:10px;
      z-index:10;
      background:rgba(255,255,255,.9);
      padding:8px 10px;
      border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,.2);
      display:flex;
      flex-wrap:wrap;
      gap:4px;
    }
    button{
      padding:8px 10px;
      margin:0;
      border-radius:10px;
      border:none;
      cursor:pointer;
      font-weight:600;
      background:#ffb703;
    }
    #msg{
      position:fixed;
      left:50%;
      bottom:12px;
      transform:translateX(-50%);
      background:rgba(255,255,255,.95);
      padding:8px 14px;
      border-radius:14px;
      box-shadow:0 4px 12px rgba(0,0,0,.2);
      font-size:14px;
      max-width:90vw;
      text-align:center;
    }
  </style>
</head>
<body>

<div id="controls">
  <button id="leftBtn">‚¨Ö Walk</button>
  <button id="stopBtn">‚è∏ Stop</button>
  <button id="rightBtn">Walk ‚û°</button>
  <button id="petBtn">‚ù§Ô∏è Pet</button>
  <button id="feedBtn">üçñ Feed</button>
</div>

<div id="msg">Walk to the pictures to visit all 10 Yosemite landmarks!</div>

<canvas id="game"></canvas>

<script>
// =========================================================
//  MY FOREVER DOG ‚Äî YOSEMITE WORLD
// =========================================================

// ---------- canvas ----------
const canvas = document.getElementById("game");
const ctx    = canvas.getContext("2d");
const msgEl  = document.getElementById("msg");

function resize(){
  canvas.width  = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

// where the FEET go (dog stands here, on screen)
function dogGroundY(){ return canvas.height - 70; }
// landmark sign base line (on screen)
function signGroundY(){ return canvas.height - 150; }

// how tall the *actual dog body* should appear (not whole PNG)
const DOG_BODY_SCREEN_HEIGHT = 320;
const WALK_FRAMES            = 5;

// ---------- WORLD + CAMERA ----------
let WORLD_W = 5000;
const camera = { x: 0 };

function centerCameraOn(x){
  camera.x = clamp(x - canvas.width / 2, 0, Math.max(0, WORLD_W - canvas.width));
}

// ---------- Yosemite landmarks ----------
const LANDMARK_SPACING = 700;
const START_X          = 600;

const parks = [
  {
    name:"Tunnel View",
    subtitle:"First glimpse of the whole valley",
    imageKey:"yos_tunnel",
    guideLine:"This is Tunnel View, one of the most famous views in Yosemite Valley.",
    dogLine:"Everything is so big! I feel tiny, but happy."
  },
  {
    name:"Yosemite Falls",
    subtitle:"Tall waterfall crashing down",
    imageKey:"yos_falls",
    guideLine:"These are Yosemite Falls, some of the tallest waterfalls in North America.",
    dogLine:"That‚Äôs a lot of water. I‚Äôll watch from here so my paws stay dry."
  },
  {
    name:"El Capitan",
    subtitle:"A giant granite wall",
    imageKey:"yos_elcap",
    guideLine:"This is El Capitan, a huge granite wall that climbers love.",
    dogLine:"Nope. I‚Äôm not climbing that. I‚Äôll cheer from the ground!"
  },
  {
    name:"Half Dome",
    subtitle:"Famous rounded rock dome",
    imageKey:"yos_halfdome",
    guideLine:"Half Dome looks like a giant rock sliced right down the middle.",
    dogLine:"It‚Äôs like a huge cookie someone took a bite out of!"
  },
  {
    name:"Glacier Point",
    subtitle:"High viewpoint over the valley",
    imageKey:"yos_glacier",
    guideLine:"From Glacier Point, you can see far across the valley below.",
    dogLine:"Wow. I can see everything from up here‚Ä¶ even good stick spots."
  },
  {
    name:"Mirror Lake",
    subtitle:"Water reflecting the cliffs",
    imageKey:"yos_mirror",
    guideLine:"Mirror Lake sometimes reflects the cliffs like a shiny mirror.",
    dogLine:"Is that another dog in the water? Oh‚Ä¶ it‚Äôs just me!"
  },
  {
    name:"Mariposa Grove",
    subtitle:"Giant sequoia trees",
    imageKey:"yos_grove",
    guideLine:"Mariposa Grove is home to giant sequoia trees, thousands of years old.",
    dogLine:"These trees are older than any human I know. I‚Äôll sniff politely."
  },
  {
    name:"Valley Meadow",
    subtitle:"Grassy field for picnics",
    imageKey:"yos_meadow",
    guideLine:"This meadow is a quiet, grassy place where people rest and play.",
    dogLine:"This is perfect for rolling in the grass. Don‚Äôt tell anyone."
  },
  {
    name:"Vernal Fall",
    subtitle:"Misty staircase waterfall",
    imageKey:"yos_vernal",
    guideLine:"Vernal Fall is reached by a long, misty staircase trail.",
    dogLine:"So many steps! My paws are ready, but we can just look today."
  },
  {
    name:"Camp 4",
    subtitle:"Historic climbers‚Äô campground",
    imageKey:"yos_camp4",
    guideLine:"Camp 4 is a historic campground where many climbers stay.",
    dogLine:"We made it! Can we stay here forever and nap under the stars?"
  }
];

parks.forEach((p, i) => {
  p.x = START_X + i * LANDMARK_SPACING;
  p.visited = false;
});

WORLD_W = parks[parks.length - 1].x + 800;

// ---------- sprite + image meta ----------
const images = {};
const meta   = {};

function loadSprite(state, filename, frames){
  const img = new Image();
  img.src = "assets/" + filename;
  img.onload = ()=> analyzeSprite(state, img, frames);
  images[state] = img;
}

function loadImageAsset(key, filename){
  const img = new Image();
  img.src = "assets/" + filename;
  images[key] = img;
}

// later when you have art:
// loadImageAsset("yos_tunnel", "yos_tunnel.png");

function analyzeSprite(state, img, frames){
  const frameW = img.width / frames;
  const frameH = img.height;

  const off = document.createElement("canvas");
  off.width  = frameW;
  off.height = frameH;
  const octx = off.getContext("2d");

  octx.clearRect(0,0,frameW,frameH);
  octx.drawImage(img, 0, 0, frameW, frameH, 0, 0, frameW, frameH);

  const data = octx.getImageData(0,0,frameW,frameH).data;

  let top = frameH, bottom = -1;
  for(let y=0;y<frameH;y++){
    for(let x=0;x<frameW;x++){
      const idx = (y*frameW + x)*4;
      const alpha = data[idx+3];
      if(alpha > 10){
        if(y < top)    top = y;
        if(y > bottom) bottom = y;
      }
    }
  }

  if(bottom === -1){
    meta[state] = { frameW, frameH, contentHeight: frameH, bottomMargin: 0 };
    return;
  }

  const contentHeight = bottom - top + 1;
  const bottomMargin  = (frameH - 1) - bottom;

  meta[state] = { frameW, frameH, contentHeight, bottomMargin };
}

// load dog sprites
loadSprite("walk", "dog_walk.png", WALK_FRAMES);
loadSprite("idle", "dog_idle.png", 1);

// ---------- SOUND: bark ----------
let barkSound = null;
try {
  barkSound = new Audio("assets/bark.mp3");
  barkSound.volume = 0.7;
} catch(e){
  console.warn("No bark sound:", e);
}

function playBark(){
  if(!barkSound) return;
  try{
    barkSound.currentTime = 0;
    barkSound.play();
  } catch(e){
    console.warn("Could not play bark:", e);
  }
}

/* ---------- SPEECH: smoother guide + clear dog ---------- */
function speakForLandmark(p, index, total){
  if (!("speechSynthesis" in window)) return;

  const synth = window.speechSynthesis;
  synth.cancel(); // stop any previous speech

  const guideText = `Landmark ${index} of ${total}. ${p.name}. ${p.guideLine}`;
  const dogText   = p.dogLine;

  // GUIDE
  const guideUtter = new SpeechSynthesisUtterance(guideText);
  guideUtter.voice = guideVoice;
  guideUtter.rate  = 0.95;
  guideUtter.pitch = 1.0;

  // DOG (queued for after guide)
  guideUtter.onend = () => {
    const dogUtter = new SpeechSynthesisUtterance(dogText);
    dogUtter.voice = dogVoice;
    dogUtter.rate  = 1.25;
    dogUtter.pitch = 1.7;
    synth.speak(dogUtter);
  };

  synth.speak(guideUtter);
}



// ---------- dog state ----------
const dog = {
  x: 200,
  dir: 1,
  speed: 7,
  state: "idle",   // "idle" or "walk"
  frame: 0
};

let left  = false;
let right = false;

let interactionTimer = 0;
let interactionType  = null;

// ---------- controls ----------
const leftBtn  = document.getElementById("leftBtn");
const rightBtn = document.getElementById("rightBtn");
const stopBtn  = document.getElementById("stopBtn");
const petBtn   = document.getElementById("petBtn");
const feedBtn  = document.getElementById("feedBtn");

function stopMoving(){
  left = right = false;
  dog.state = "idle";
}

function startWalkLeft(){
  if(interactionTimer > 0) return;
  left  = true;
  right = false;
  dog.dir = -1;
  dog.state = "walk";
}
function startWalkRight(){
  if(interactionTimer > 0) return;
  right = true;
  left  = false;
  dog.dir = 1;
  dog.state = "walk";
}

leftBtn.onclick  = startWalkLeft;
rightBtn.onclick = startWalkRight;

stopBtn.onclick = function(){
  interactionTimer = 0;
  interactionType  = null;
  stopMoving();
};

petBtn.onclick = function(){
  stopMoving();
  interactionTimer = 120;
  interactionType  = "pet";
  playBark();
  showMsg("Your dog loves pets ‚ù§Ô∏è");
};

feedBtn.onclick = function(){
  stopMoving();
  interactionTimer = 120;
  interactionType  = "feed";
  playBark();
  showMsg("Yum! Snack time üçñ");
};

window.addEventListener("keydown", function(e){
  if(e.key === "ArrowLeft")  startWalkLeft();
  if(e.key === "ArrowRight") startWalkRight();
  if(e.key === " ")          stopBtn.onclick();
});

// ---------- messages ----------
let msgTimer = 0;
function showMsg(text){
  msgEl.textContent = text;
  msgTimer = 150;
}

// ---------- update ----------
function update(){
  if(interactionTimer > 0){
    interactionTimer--;
    if(interactionTimer === 0){
      interactionType = null;
    }
  }

  if(dog.state === "walk" && interactionTimer === 0){
    if(left)  dog.x -= dog.speed;
    if(right) dog.x += dog.speed;
  }

  dog.x = clamp(dog.x, 50, WORLD_W - 50);
  centerCameraOn(dog.x);

  const dogCenter = dog.x;
  for(let i = 0; i < parks.length; i++){
    const p = parks[i];
    if(p.visited) continue;

    if(Math.abs(dogCenter - p.x) < 40 && dog.state === "walk"){
      stopMoving();
      p.visited = true;

      const idx = i + 1;
      const message = `Landmark ${idx}/${parks.length}: ${p.name} ‚Äî ${p.subtitle}`;
      showMsg(message);
      speakForLandmark(p, idx, parks.length);
      break;
    }
  }

  if(msgTimer > 0){
    msgTimer--;
    if(msgTimer === 0){
      msgEl.textContent = "Walk to the pictures to visit all 10 Yosemite landmarks!";
    }
  }

  dog.frame++;
}

// ---------- drawing ----------
function drawBackground(){
  ctx.fillStyle = "#bde0fe";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle = "rgba(255,255,255,0.5)";
  const hillY = 220;
  const hillW = 500;
  const parallax = camera.x * 0.4;
  for(let i = -2; i < 10; i++){
    const cx = (i * hillW) - (parallax % hillW);
    ctx.beginPath();
    ctx.moveTo(cx, hillY + 80);
    ctx.lineTo(cx + hillW/2, hillY - 60);
    ctx.lineTo(cx + hillW, hillY + 80);
    ctx.closePath();
    ctx.fill();
  }

  const gy = dogGroundY();
  ctx.fillStyle = "#90e0ef";
  ctx.fillRect(0, gy, canvas.width, canvas.height - gy);
}

function drawParks(){
  const sg = signGroundY();
  ctx.textBaseline = "middle";

  for(let i = 0; i < parks.length; i++){
    const p = parks[i];
    const sx = p.x - camera.x;

    if(sx < -250 || sx > canvas.width + 250) continue;

    const photoTop = sg - 150;
    const photoW   = 180;
    const photoH   = 110;
    const photoX   = sx - photoW/2;

    ctx.fillStyle = "rgba(255,255,255,0.95)";
    ctx.fillRect(photoX, photoTop, photoW, photoH);
    ctx.strokeStyle = "rgba(0,0,0,0.15)";
    ctx.strokeRect(photoX, photoTop, photoW, photoH);

    const lmImg = images[p.imageKey];
    if(lmImg && lmImg.complete){
      const scale = Math.min((photoW-8)/lmImg.width, (photoH-8)/lmImg.height);
      const w = lmImg.width * scale;
      const h = lmImg.height * scale;
      const ix = photoX + (photoW - w)/2;
      const iy = photoTop + (photoH - h)/2;
      ctx.drawImage(lmImg, ix, iy, w, h);
    } else {
      ctx.fillStyle = "#90e0ef";
      ctx.fillRect(photoX+4, photoTop+4, photoW-8, (photoH/2)-6);
      ctx.fillStyle = "#2a9d8f";
      ctx.fillRect(photoX+4, photoTop+photoH/2-2, photoW-8, photoH/2-6);

      ctx.fillStyle = "#264653";
      ctx.beginPath();
      ctx.moveTo(sx, photoTop+24);
      ctx.lineTo(photoX+24, photoTop+photoH-10);
      ctx.lineTo(photoX+photoW-24, photoTop+photoH-10);
      ctx.closePath();
      ctx.fill();
    }

    const signTop = sg - 20;

    ctx.fillStyle = "rgba(0,0,0,0.35)";
    ctx.fillRect(sx - 3, photoTop + photoH, 6, (signTop + 10) - (photoTop + photoH));

    ctx.fillStyle = "rgba(255,255,255,0.96)";
    ctx.fillRect(sx - 140, signTop, 280, 54);

    ctx.fillStyle = "#000";
    ctx.font = "15px system-ui";
    ctx.fillText(p.name, sx - 132, signTop + 20);
    ctx.font = "12px system-ui";
    ctx.fillText(p.subtitle, sx - 132, signTop + 38);

    ctx.fillStyle = p.visited ? "#2a9d8f" : "#e76f51";
    ctx.beginPath();
    ctx.arc(sx + 120, signTop + 27, 7, 0, Math.PI*2);
    ctx.fill();
  }
}

function drawDog(){
  const state = (dog.state === "walk") ? "walk" : "idle";

  const img  = images[state];
  const info = meta[state];

  if(!img || !img.complete || !info) return;

  const frames = (state === "walk") ? WALK_FRAMES : 1;

  const frameW = info.frameW;
  const frameH = info.frameH;
  const contentHeight = info.contentHeight;
  const bottomMargin  = info.bottomMargin;

  const bodyScale = DOG_BODY_SCREEN_HEIGHT / contentHeight;

  const drawW = frameW * bodyScale;
  const drawH = frameH * bodyScale;
  const bottomMarginScaled = bottomMargin * bodyScale;

  let frameIndex = 0;
  if(state === "walk" && frames > 1){
    frameIndex = Math.floor(dog.frame / 6) % frames;
  }

  const sxCrop = frameIndex * frameW;

  const gxWorld = dog.x;
  const gx      = gxWorld - camera.x;
  const gy      = dogGroundY();

  const dx = gx - drawW / 2;
  const dy = gy - (drawH - bottomMarginScaled);

  ctx.save();
  if(dog.dir < 0){
    ctx.scale(-1,1);
    ctx.drawImage(
      img,
      sxCrop, 0, frameW, frameH,
      -dx - drawW, dy,
      drawW, drawH
    );
  } else {
    ctx.drawImage(
      img,
      sxCrop, 0, frameW, frameH,
      dx, dy,
      drawW, drawH
    );
  }
  ctx.restore();

  if(interactionTimer > 0 && interactionType){
    ctx.font = "32px system-ui";
    ctx.textBaseline = "middle";
    ctx.textAlign = "center";
    const icon = interactionType === "pet" ? "‚ù§Ô∏è" : "üçñ";
    const iconY = dy - 30;
    ctx.fillText(icon, gx, iconY);
    ctx.textAlign = "start";
  }
}

// ---------- main loop ----------
function loop(){
  update();
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawBackground();
  drawParks();
  drawDog();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
