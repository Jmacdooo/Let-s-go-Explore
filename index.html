<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>My Forever Dog ‚Äî Parks</title>
<style>
  body{
    margin:0;
    background:#000;
    overflow:hidden;
    font-family: system-ui, -apple-system, sans-serif;
  }
  canvas{
    display:block;
    width:100vw;
    height:100vh;
  }
  #controls{
    position:fixed;
    left:10px;
    top:10px;
    z-index:10;
    background:rgba(255,255,255,.9);
    padding:8px 10px;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,.2);
  }
  button{
    padding:8px 10px;
    margin:2px;
    border-radius:10px;
    border:none;
    cursor:pointer;
    font-weight:600;
    background:#ffb703;
  }
  #msg{
    position:fixed;
    left:50%;
    bottom:12px;
    transform:translateX(-50%);
    background:rgba(255,255,255,.95);
    padding:8px 14px;
    border-radius:14px;
    box-shadow:0 4px 12px rgba(0,0,0,.2);
    font-size:14px;
    max-width:90vw;
    text-align:center;
  }
  #progress{
    position:fixed;
    right:10px;
    top:10px;
    z-index:10;
    background:rgba(255,255,255,.9);
    padding:6px 10px;
    border-radius:10px;
    box-shadow:0 4px 12px rgba(0,0,0,.2);
    font-size:13px;
  }
</style>
</head>
<body>

<div id="controls">
  <button id="leftBtn">‚¨Ö Walk</button>
  <button id="stopBtn">‚è∏ Stop</button>
  <button id="rightBtn">Walk ‚û°</button>
  <button id="petBtn">‚ù§Ô∏è Pet</button>
  <button id="feedBtn">üçñ Feed</button>
</div>

<div id="progress">Visited: 0 / 3 landmarks</div>
<div id="msg">Walk to visit the national parks!</div>

<canvas id="game"></canvas>

<script>
// ======================================================
// Simple helpers
// ======================================================
const canvas = document.getElementById("game");
const ctx    = canvas.getContext("2d");
const msgEl  = document.getElementById("msg");
const progressEl = document.getElementById("progress");

function resize(){
  canvas.width  = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

function dogGroundY(){ return canvas.height - 70; }
function signGroundY(){ return canvas.height - 150; }

function loadImage(path){
  const img = new Image();
  img.src = path;
  return img;
}

// ======================================================
// Assets
// ======================================================

// MAIN PATH BACKGROUND (Yosemite trail)
const bgImages = {
  main:        loadImage("assets/yosemite.png"),               // <- your main Yosemite picture
  half_dome:   loadImage("assets/parks/half_dome.png"),        // <- close-up photo of Half Dome
  yose_falls:  loadImage("assets/parks/yosemite_falls.png"),   // <- photo of Yosemite Falls
  tunnel_view: loadImage("assets/parks/tunnel_view.png")       // <- photo of Tunnel View
};
let currentBgKey = "main";

// DOG SPRITES
const dogWalkImg = loadImage("assets/dog_walk.png");  // 6-frame strip, faces LEFT
const dogIdleImg = loadImage("assets/dog_idle.png");  // single frame (optional)

// sprite constants
const DOG_FRAME_W = 256;
const DOG_FRAME_H = 256;
const DOG_WALK_FRAMES = 6;
const DOG_SCALE = 0.8;               // make the dog bigger/smaller
const DOG_ANIM_SPEED = 6;            // higher = faster leg movement
const DOG_SPEED = 6;                 // movement speed

// BARK SOUND
let barkSound = null;
try {
  barkSound = new Audio("assets/bark.mp3");
} catch(e) {
  console.warn("bark.mp3 missing");
}
function playBark(){
  if(!barkSound) return;
  barkSound.currentTime = 0;
  barkSound.play().catch(()=>{});
}

// ======================================================
// Landmark data (with background keys)
// ======================================================
const parks = [
  {
    id: "half_dome",
    name:"Half Dome",
    subtitle:"Yosemite",
    pos:0.30,
    bgKey:"half_dome",
    visited:false,
    guideLine:"This is Half Dome, a huge granite rock shaped by glaciers.",
    dogLine:"Whoa! It‚Äôs gigantic! Can we climb just a tiny part?"
  },
  {
    id: "yose_falls",
    name:"Yosemite Falls",
    subtitle:"Upper & Lower Falls",
    pos:0.60,
    bgKey:"yose_falls",
    visited:false,
    guideLine:"These are Yosemite Falls, some of the tallest waterfalls in North America.",
    dogLine:"I can almost feel the mist on my nose!"
  },
  {
    id: "tunnel_view",
    name:"Tunnel View",
    subtitle:"Famous lookout",
    pos:0.90,
    bgKey:"tunnel_view",
    visited:false,
    guideLine:"Tunnel View shows Half Dome, El Capitan, and Bridalveil Fall together.",
    dogLine:"This is the perfect place for a picture of us!"
  }
];

// ======================================================
// Speech (guide + dog)
// ======================================================
let guideVoice = null;
let dogVoice   = null;

function initVoices(){
  if (!("speechSynthesis" in window)) return;
  const voices = window.speechSynthesis.getVoices();
  if (!voices || !voices.length) return;

  guideVoice =
    voices.find(v => v.name.includes("Google UK English Female")) ||
    voices.find(v => v.name.includes("Google US English")) ||
    voices.find(v => v.lang.startsWith("en")) ||
    voices[0];

  dogVoice =
    voices.find(v =>
      v !== guideVoice &&
      v.lang.startsWith("en") &&
      /child|girl|boy|Google UK English|Google US English/i.test(v.name + v.voiceURI)
    ) ||
    voices.find(v => v !== guideVoice && v.lang.startsWith("en")) ||
    voices.find(v => v !== guideVoice) ||
    guideVoice;
}

if ("speechSynthesis" in window) {
  window.speechSynthesis.onvoiceschanged = initVoices;
  initVoices();
}

function speakForLandmark(p, index, total){
  const guideText = `Landmark ${index} of ${total}: ${p.name}. ${p.guideLine || ""}`;
  const dogText   = p.dogLine || "";

  showMsg(guideText + (dogText ? " " + dogText : ""));

  if (!("speechSynthesis" in window)) return;
  const synth = window.speechSynthesis;
  synth.cancel();

  const g = new SpeechSynthesisUtterance(guideText);
  if (guideVoice) g.voice = guideVoice;
  g.rate  = 0.95;
  g.pitch = 1.0;

  g.onend = () => {
    if (!dogTe
