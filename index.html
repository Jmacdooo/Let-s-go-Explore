<!DOCTYPE html> 
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>My Forever Dog ‚Äî Parks</title>
<style>
  body{
    margin:0;
    background:#bde0fe;
    overflow:hidden;
    font-family: system-ui, -apple-system, sans-serif;
  }
  canvas{
    display:block;
    width:100vw;
    height:100vh;
  }
  #controls{
    position:fixed;
    left:10px;
    top:10px;
    z-index:10;
    background:rgba(255,255,255,.9);
    padding:8px 10px;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,.2);
  }
  button{
    padding:8px 10px;
    margin:2px;
    border-radius:10px;
    border:none;
    cursor:pointer;
    font-weight:600;
    background:#ffb703;
  }
  #msg{
    position:fixed;
    left:50%;
    bottom:12px;
    transform:translateX(-50%);
    background:rgba(255,255,255,.95);
    padding:8px 14px;
    border-radius:14px;
    box-shadow:0 4px 12px rgba(0,0,0,.2);
    font-size:14px;
    max-width:90vw;
    text-align:center;
  }
</style>
</head>
<body>

<div id="controls">
  <button id="leftBtn">‚¨Ö Walk</button>
  <button id="stopBtn">‚è∏ Stop</button>
  <button id="rightBtn">Walk ‚û°</button>
  <button id="petBtn">‚ù§Ô∏è Pet</button>
  <button id="feedBtn">üçñ Feed</button>
</div>

<div id="msg">Walk to the picture to visit this landmark!</div>

<canvas id="game"></canvas>

<script>
/* =========================================================
   DOG = SAME. 
   New: each landmark on its own screen.
   Dog walks from left ‚Üí photo card on right ‚Üí sits ‚Üí next screen.
   ========================================================= */

// ---------- canvas ----------
const canvas = document.getElementById("game");
const ctx    = canvas.getContext("2d");
const msgEl  = document.getElementById("msg");

function resize(){
  canvas.width  = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

// where the FEET go (dog stands here)
function dogGroundY(){ return canvas.height - 70; }   // tweak 70 if you want dog higher/lower
// landmark sign base line
function signGroundY(){ return canvas.height - 150; }

// how tall the *actual dog body* should appear (not whole PNG)
const DOG_BODY_SCREEN_HEIGHT = 320;   // bump to 350/380 if you want bigger dog
const WALK_FRAMES            = 5;

// ---------- ALL PARKS (10 landmarks each) ----------
const parkConfigs = [
  {
    id: "yosemite",
    title: "Yosemite National Park",
    bgKey: "bg_yosemite",   // optional PNG later: assets/bg_yosemite.png
    landmarks: [
      { name:"Tunnel View",       subtitle:"First glimpse of the whole valley",      imageKey:"yos_tunnel" },
      { name:"Yosemite Falls",    subtitle:"A huge waterfall crashing down",        imageKey:"yos_falls" },
      { name:"El Capitan",        subtitle:"A giant granite wall for climbers",     imageKey:"yos_elcap" },
      { name:"Half Dome",         subtitle:"The famous rounded rock dome",          imageKey:"yos_halfdome" },
      { name:"Glacier Point",     subtitle:"A lookout high above the valley",       imageKey:"yos_glacier" },
      { name:"Mirror Lake",       subtitle:"A calm lake that reflects the cliffs",  imageKey:"yos_mirror" },
      { name:"Mariposa Grove",    subtitle:"A forest of giant sequoia trees",       imageKey:"yos_grove" },
      { name:"Valley Meadow",     subtitle:"A grassy field for picnics and play",   imageKey:"yos_meadow" },
      { name:"Vernal Fall",       subtitle:"A misty waterfall with lots of steps",  imageKey:"yos_vernal" },
      { name:"Tioga Pass",        subtitle:"High country road with lakes and peaks",imageKey:"yos_tioga" }
    ]
  },
  {
    id: "yellowstone",
    title: "Yellowstone National Park",
    bgKey: "bg_yellowstone",   // optional PNG: assets/bg_yellowstone.png
    landmarks: [
      { name:"Old Faithful",          subtitle:"A geyser that erupts on a schedule", imageKey:"yel_oldfaithful" },
      { name:"Grand Prismatic Spring",subtitle:"A rainbow-colored hot spring",       imageKey:"yel_prismatic" },
      { name:"Mammoth Terraces",      subtitle:"White and orange stone terraces",    imageKey:"yel_mammoth" },
      { name:"Yellowstone Lake",      subtitle:"A huge high-mountain lake",          imageKey:"yel_lake" },
      { name:"Grand Canyon of YNP",   subtitle:"Colorful canyon with waterfalls",    imageKey:"yel_canyon" },
      { name:"Norris Geyser Basin",   subtitle:"Steaming earth and hot pools",       imageKey:"yel_norris" },
      { name:"Hayden Valley",         subtitle:"Meadow with bison and birds",        imageKey:"yel_hayden" },
      { name:"Lamar Valley",          subtitle:"Wildlife valley with wolves",        imageKey:"yel_lamar" },
      { name:"Tower Fall",            subtitle:"Tall narrow waterfall through rock", imageKey:"yel_tower" },
      { name:"Fountain Paint Pot",    subtitle:"Bubbling mud pots",                  imageKey:"yel_paintpot" }
    ]
  }
];

// mark all as not visited (for possible future progress)
parkConfigs.forEach(park => {
  park.landmarks.forEach(lm => lm.visited = false);
});

// current park + landmark indexes
let currentParkIndex      = 0;
let currentLandmarkIndex  = 0;

// helpers
function getCurrentPark(){
  return parkConfigs[currentParkIndex];
}
function getCurrentLandmark(){
  return getCurrentPark().landmarks[currentLandmarkIndex];
}

// ---------- sprite meta (DOG) ----------
const images = {};
const meta   = {};  // meta[state] = { frameW, frameH, contentHeight, bottomMargin }

function loadSprite(state, filename, frames){
  const img = new Image();
  img.src = "assets/" + filename;
  img.onload = ()=> analyzeSprite(state, img, frames);
  images[state] = img;
}

// generic image loader for future PNGs (park backgrounds, landmark photos)
function loadImageAsset(key, filename){
  const img = new Image();
  img.src = "assets/" + filename;
  images[key] = img;
}

function analyzeSprite(state, img, frames){
  const frameW = img.width / frames;
  const frameH = img.height;

  const off = document.createElement("canvas");
  off.width  = frameW;
  off.height = frameH;
  const octx = off.getContext("2d");

  octx.clearRect(0,0,frameW,frameH);
  octx.drawImage(img, 0, 0, frameW, frameH, 0, 0, frameW, frameH);

  const data = octx.getImageData(0,0,frameW,frameH).data;

  let top = frameH, bottom = -1;
  for(let y=0;y<frameH;y++){
    for(let x=0;x<frameW;x++){
      const idx = (y*frameW + x)*4;
      const alpha = data[idx+3];
      if(alpha > 10){ // not transparent
        if(y < top)    top = y;
        if(y > bottom) bottom = y;
      }
    }
  }

  if(bottom === -1){
    // empty fallback
    meta[state] = {
      frameW, frameH,
      contentHeight: frameH,
      bottomMargin: 0
    };
    return;
  }

  const contentHeight = bottom - top + 1;
  const bottomMargin  = (frameH - 1) - bottom;

  meta[state] = {
    frameW,
    frameH,
    contentHeight,
    bottomMargin
  };
}

// load walking + idle (DOG SPRITES ‚Äì SAME AS BEFORE)
loadSprite("walk", "dog_walk.png", WALK_FRAMES);
loadSprite("idle", "dog_idle.png", 1);

// OPTIONAL: later, when you have PNGs, uncomment and add lines like:
// loadImageAsset("bg_yosemite", "bg_yosemite.png");
// loadImageAsset("yos_tunnel", "yos_tunnel.png");
// loadImageAsset("yel_oldfaithful", "yel_oldfaithful.png");
// etc.

// ---------- dog state (UNCHANGED BASICS) ----------
const dog = {
  x: canvas.width * 0.15,
  dir: 1,
  speed: 7,
  state: "idle",   // "idle" or "walk"
  frame: 0
};

let left  = false;
let right = false;

// ---------- controls ----------
const leftBtn  = document.getElementById("leftBtn");
const rightBtn = document.getElementById("rightBtn");
const stopBtn  = document.getElementById("stopBtn");
const petBtn   = document.getElementById("petBtn");
const feedBtn  = document.getElementById("feedBtn");

function stopMoving(){
  left = right = false;
  dog.state = "idle";
}

leftBtn.onclick = function(){
  left  = true;
  right = false;
  dog.dir = -1;
  dog.state = "walk";
};

rightBtn.onclick = function(){
  right = true;
  left  = false;
  dog.dir = 1;
  dog.state = "walk";
};

stopBtn.onclick = stopMoving;

// Pet + feed just show idle pose + message for now
petBtn.onclick = function(){
  stopMoving();
  showMsg("Your dog loves pets ‚ù§Ô∏è");
};

feedBtn.onclick = function(){
  stopMoving();
  showMsg("Yum! Snack time üçñ");
};

window.addEventListener("keydown", function(e){
  if(e.key === "ArrowLeft")  leftBtn.onclick();
  if(e.key === "ArrowRight") rightBtn.onclick();
  if(e.key === " ")          stopBtn.onclick();
});

// ---------- messages ----------
let msgTimer = 0;
function showMsg(text){
  msgEl.textContent = text;
  msgTimer = 150;
}

// When dog finishes a screen, wait a bit then go to next
let advanceTimer = 0;

function goToNextScreen(){
  const park = getCurrentPark();

  if(currentLandmarkIndex < park.landmarks.length - 1){
    currentLandmarkIndex++;
    const next = getCurrentLandmark();
    dog.x = canvas.width * 0.15;
    dog.state = "idle";
    left = right = false;
    showMsg(`Next in ${park.title}: ${next.name} ‚Äî walk to the picture!`);
  } else if(currentParkIndex < parkConfigs.length - 1){
    // next park
    currentParkIndex++;
    currentLandmarkIndex = 0;
    const newPark = getCurrentPark();
    dog.x = canvas.width * 0.15;
    dog.state = "idle";
    left = right = false;
    showMsg(`New park: ${newPark.title}! Walk to the picture to start.`);
  } else {
    // all done
    showMsg("You visited every landmark in every park! üéâ");
  }
}

// ---------- update ----------
function update(){
  // move dog
  if(dog.state === "walk"){
    if(left)  dog.x -= dog.speed;
    if(right) dog.x += dog.speed;
  }

  // clamp dog on screen
  dog.x = Math.max(60, Math.min(canvas.width - 60, dog.x));

  const park = getCurrentPark();
  const landmark = getCurrentLandmark();

  // GOAL position (about 20-ish steps away)
  const goalX = canvas.width * 0.75;   // dog starts at 0.15 * width

  // if walking and not already queued to advance
  if(dog.state === "walk" && advanceTimer === 0){
    if(dog.x >= goalX - 10){
      // arrive at landmark: SIT (idle) + mark visited + show text
      stopMoving();
      landmark.visited = true;
      const idx = currentLandmarkIndex;
      showMsg(`Landmark ${idx+1}/${park.landmarks.length}: ${landmark.name} ‚Äî ${landmark.subtitle}`);
      // after short pause, auto-move to next screen
      advanceTimer = 90; // ~1.5 seconds
    }
  }

  if(advanceTimer > 0){
    advanceTimer--;
    if(advanceTimer === 0){
      goToNextScreen();
    }
  }

  if(msgTimer > 0){
    msgTimer--;
    if(msgTimer === 0){
      msgEl.textContent = "Walk to the picture to visit this landmark!";
    }
  }

  dog.frame++;
}

// ---------- draw helpers ----------
function drawBackground(){
  // sky
  ctx.fillStyle = "#bde0fe";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  const currentPark = getCurrentPark();
  const bgKey = currentPark.bgKey;
  const bgImg = images[bgKey];

  const headerH = 140;
  if(bgImg && bgImg.complete){
    // draw park PNG stretched across top
    const scale = Math.max(canvas.width / bgImg.width, headerH / bgImg.height);
    const w = bgImg.width * scale;
    const h = bgImg.height * scale;
    const x = (canvas.width - w) / 2;
    const y = 0;
    ctx.drawImage(bgImg, x, y, w, h);
  } else {
    // fallback colored banner with park title
    ctx.fillStyle = "rgba(255,255,255,0.85)";
    ctx.fillRect(0,0,canvas.width,headerH);
    ctx.fillStyle = "#023047";
    ctx.font = "20px system-ui";
    ctx.fillText(currentPark.title, 16, 40);
    ctx.font = "14px system-ui";
    ctx.fillText(`Landmark ${currentLandmarkIndex+1}/${currentPark.landmarks.length}`, 16, 70);
  }

  // ground
  const gy = dogGroundY();
  ctx.fillStyle = "#90e0ef";
  ctx.fillRect(0, gy, canvas.width, canvas.height - gy);
}

// ONE landmark per screen: photo on right, dog walks to it
function drawParks(){
  const sg = signGroundY();
  ctx.textBaseline = "middle";

  const park     = getCurrentPark();
  const p        = getCurrentLandmark();
  const x        = canvas.width * 0.75;  // where the landmark "lives"

  // --- photo thumbnail frame ---
  const photoTop = sg - 150;
  const photoW   = 180;
  const photoH   = 110;
  const photoX   = x - photoW/2;

  ctx.fillStyle = "rgba(255,255,255,0.95)";
  ctx.fillRect(photoX, photoTop, photoW, photoH);
  ctx.strokeStyle = "rgba(0,0,0,0.15)";
  ctx.strokeRect(photoX, photoTop, photoW, photoH);

  // if you have a PNG for this landmark, draw it here
  const lmImg = images[p.imageKey];
  if(lmImg && lmImg.complete){
    const scale = Math.min((photoW-8)/lmImg.width, (photoH-8)/lmImg.height);
    const w = lmImg.width * scale;
    const h = lmImg.height * scale;
    const ix = photoX + (photoW - w)/2;
    const iy = photoTop + (photoH - h)/2;
    ctx.drawImage(lmImg, ix, iy, w, h);
  } else {
    // placeholder mini landscape (sky + ground + mountain)
    ctx.fillStyle = "#90e0ef";
    ctx.fillRect(photoX+4, photoTop+4, photoW-8, (photoH/2)-6);
    ctx.fillStyle = "#2a9d8f";
    ctx.fillRect(photoX+4, photoTop+photoH/2-2, photoW-8, photoH/2-6);

    ctx.fillStyle = "#264653";
    ctx.beginPath();
    ctx.moveTo(x, photoTop+22);
    ctx.lineTo(photoX+24, photoTop+photoH-10);
    ctx.lineTo(photoX+photoW-24, photoTop+photoH-10);
    ctx.closePath();
    ctx.fill();
  }

  // --- sign pole + label under photo ---
  const signTop = sg - 20;

  // pole
  ctx.fillStyle = "rgba(0,0,0,0.35)";
  ctx.fillRect(x - 3, photoTop + photoH, 6, (signTop + 10) - (photoTop + photoH));

  // sign
  ctx.fillStyle = "rgba(255,255,255,0.96)";
  ctx.fillRect(x - 120, signTop, 240, 54);

  ctx.fillStyle = "#000";
  ctx.font = "15px system-ui";
  ctx.fillText(p.name, x - 112, signTop + 20);
  ctx.font = "12px system-ui";
  ctx.fillText(p.subtitle, x - 112, signTop + 38);

  // visited dot
  ctx.fillStyle = p.visited ? "#2a9d8f" : "#e76f51";
  ctx.beginPath();
  ctx.arc(x + 100, signTop + 27, 7, 0, Math.PI*2);
  ctx.fill();
}

// ---------- draw dog (walk + idle match ‚Äì SAME AS BEFORE) ----------
function drawDog(){
  const state = (dog.state === "walk") ? "walk" : "idle";

  const img  = images[state];
  const info = meta[state];

  if(!img || !img.complete || !info) return;

  const frames = (state === "walk") ? WALK_FRAMES : 1;

  const frameW = info.frameW;
  const frameH = info.frameH;
  const contentHeight = info.contentHeight;
  const bottomMargin  = info.bottomMargin;

  // scale so the VISIBLE dog body equals DOG_BODY_SCREEN_HEIGHT
  const bodyScale = DOG_BODY_SCREEN_HEIGHT / contentHeight;

  const drawW = frameW * bodyScale;
  const drawH = frameH * bodyScale;
  const bottomMarginScaled = bottomMargin * bodyScale;

  // choose frame
  let frameIndex = 0;
  if(state === "walk" && frames > 1){
    frameIndex = Math.floor(dog.frame / 6) % frames;
  }

  const sx = frameIndex * frameW;

  const gx = dog.x;
  const gy = dogGroundY();   // FEET line

  const dx = gx - drawW / 2;
  const dy = gy - (drawH - bottomMarginScaled);

  ctx.save();
  if(dog.dir < 0){
    ctx.scale(-1,1);
    ctx.drawImage(
      img,
      sx, 0, frameW, frameH,
      -dx - drawW, dy,
      drawW, drawH
    );
  } else {
    ctx.drawImage(
      img,
      sx, 0, frameW, frameH,
      dx, dy,
      drawW, drawH
    );
  }
  ctx.restore();
}

// ---------- main loop ----------
function loop(){
  update();
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawBackground();
  drawParks();
  drawDog();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
